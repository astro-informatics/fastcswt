<HTML>
<HEAD>
   <TITLE> program s2_gcmbcoad (generated by f90doc) </TITLE>
  <LINK rel="stylesheet" href="stylesheet.css" type="text/css" /> </HEAD>
<H1> Program s2_gcmbcoad </H1>
<PRE>program s2_gcmbcoad

        ! Uses
    use <A HREF="s2_types_mod.html">s2_types_mod</A>
    use <A HREF="s2_error_mod.html">s2_error_mod</A>
    use <A HREF="s2_sky_mod.html">s2_sky_mod</A>
    use <A HREF="s2_pl_mod.html">s2_pl_mod</A>
    use <A HREF="s2_cmb_mod.html">s2_cmb_mod</A>
    use <A HREF="s2_wnoise_mod.html">s2_wnoise_mod</A>

        ! Calls
    call parse_options
    call s2_cmb_free
    call s2_error
    call s2_pl_free
    call s2_sky_compute_map
    call s2_sky_conv
    call s2_sky_downsample
    call s2_sky_free
    call s2_sky_get_map
    call s2_sky_map_convert
    call s2_sky_write_map_file
    call s2_wnoise_free

        ! Variables
    integer, parameter :: <A HREF="s2_gcmbcoad.html#var_num_bands">NUM_BANDS</A> = 8
    integer, parameter :: <A HREF="s2_gcmbcoad.html#var_nobs_ext">NOBS_EXT</A> = 2
    integer, parameter :: <A HREF="s2_gcmbcoad.html#var_lmax_limit">LMAX_LIMIT</A> = 1000
    integer, parameter :: <A HREF="s2_gcmbcoad.html#var_nside_final">NSIDE_FINAL</A> = 256
    character (len=*), parameter :: <A HREF="s2_gcmbcoad.html#var_msgpfx">msgpfx</A> = 's2_gcmbcoad> '
    real (kind=s2_sp), parameter, dimension (NUM_BANDS) :: <A HREF="s2_gcmbcoad.html#var_sigma0">SIGMA0</A> = (/ 2.26677, 2.15567, 3.28789, 2.93683, 5.85196, 6.53276, 6.88032, 6.72537 /)
    character (len=S2_STRING_LEN), parameter, dimension (NUM_BANDS) :: <A HREF="s2_gcmbcoad.html#var_filename_nobs">filename_nobs</A> = (/ 'wmap_q1_cleanimap_yr1_v1.fits', 'wmap_q2_cleanimap_yr1_v1.fits', 'wmap_v1_cleanimap_yr1_v1.fits', 'wmap_v2_cleanimap_yr1_v1.fits', 'wmap_w1_cleanimap_yr1_v1.fits', 'wmap_w2_cleanimap_yr1_v1.fits', 'wmap_w3_cleanimap_yr1_v1.fits', 'wmap_w4_cleanimap_yr1_v1.fits' /)
    character (len=S2_STRING_LEN), parameter, dimension (NUM_BANDS) :: <A HREF="s2_gcmbcoad.html#var_filename_beam">filename_beam</A> = (/ 'map_q1_ampl_bl_yr1_v1.txt', 'map_q2_ampl_bl_yr1_v1.txt', 'map_v1_ampl_bl_yr1_v1.txt', 'map_v2_ampl_bl_yr1_v1.txt', 'map_w1_ampl_bl_yr1_v1.txt', 'map_w2_ampl_bl_yr1_v1.txt', 'map_w3_ampl_bl_yr1_v1.txt', 'map_w4_ampl_bl_yr1_v1.txt' /)
    character (len=S2_STRING_LEN) :: <A HREF="s2_gcmbcoad.html#var_filename_mask">filename_mask</A>
    character (len=S2_STRING_LEN) :: <A HREF="s2_gcmbcoad.html#var_filename_cl">filename_cl</A> = 'wmap_lcdm_pl_model_yr1_v1.txt'
    character (len=S2_STRING_LEN) :: <A HREF="s2_gcmbcoad.html#var_filename_out">filename_out</A>
    character (len=S2_STRING_LEN) :: <A HREF="s2_gcmbcoad.html#var_filename_out_cmb_prefix">filename_out_cmb_prefix</A> = 'gcmb_coadded_'
    character (len=S2_STRING_LEN) :: <A HREF="s2_gcmbcoad.html#var_filename_out_noise_prefix">filename_out_noise_prefix</A> = 'wnoise_coadded_'
    character (len=S2_STRING_LEN) :: <A HREF="s2_gcmbcoad.html#var_comment_out">comment_out</A> = 'seed not specified'
    character (len=S2_STRING_LEN) :: <A HREF="s2_gcmbcoad.html#var_filename_current">filename_current</A>
    character (len=S2_STRING_LEN) :: <A HREF="s2_gcmbcoad.html#var_dir_cl">dir_cl</A> = 'data_input'
    character (len=S2_STRING_LEN) :: <A HREF="s2_gcmbcoad.html#var_dir_nobs">dir_nobs</A> = 'data_input'
    character (len=S2_STRING_LEN) :: <A HREF="s2_gcmbcoad.html#var_dir_beam">dir_beam</A> = 'data_input'
    integer :: <A HREF="s2_gcmbcoad.html#var_isim_start">isim_start</A> = 1
    integer :: <A HREF="s2_gcmbcoad.html#var_isim_end">isim_end</A> = 1
    integer :: <A HREF="s2_gcmbcoad.html#var_lmax">lmax</A>
    integer :: <A HREF="s2_gcmbcoad.html#var_lmin_cl">lmin_cl</A>
    integer :: <A HREF="s2_gcmbcoad.html#var_lmin_beam">lmin_beam</A>
    integer :: <A HREF="s2_gcmbcoad.html#var_iband">iband</A>
    integer :: <A HREF="s2_gcmbcoad.html#var_isim">isim</A>
    integer :: <A HREF="s2_gcmbcoad.html#var_fail">fail</A>
    integer :: <A HREF="s2_gcmbcoad.html#var_ncomment_cl">ncomment_cl</A>
    integer :: <A HREF="s2_gcmbcoad.html#var_ncomment_beam">ncomment_beam</A>
    integer :: <A HREF="s2_gcmbcoad.html#var_seed_cmb">seed_cmb</A> = 1
    integer :: <A HREF="s2_gcmbcoad.html#var_seed_noise">seed_noise</A> = 1
    logical :: <A HREF="s2_gcmbcoad.html#var_scale_in_cl">scale_in_cl</A> = .true.
    logical :: <A HREF="s2_gcmbcoad.html#var_scale_in_beam">scale_in_beam</A> = .false.
    logical :: <A HREF="s2_gcmbcoad.html#var_line_nos_in_cl">line_nos_in_cl</A> = .true.
    logical :: <A HREF="s2_gcmbcoad.html#var_line_nos_in_beam">line_nos_in_beam</A> = .true.
    logical :: <A HREF="s2_gcmbcoad.html#var_apply_mask">apply_mask</A> = .false.
    type (s2_pl) :: <A HREF="s2_gcmbcoad.html#var_cl">cl</A>
    type (s2_pl), dimension (NUM_BANDS) :: <A HREF="s2_gcmbcoad.html#var_beam">beam</A>
    type (s2_sky), dimension (NUM_BANDS) :: <A HREF="s2_gcmbcoad.html#var_weights">weights</A>
    type (s2_sky) :: <A HREF="s2_gcmbcoad.html#var_weights_sum">weights_sum</A>
    type (s2_sky) :: <A HREF="s2_gcmbcoad.html#var_weights_temp">weights_temp</A>
    type (s2_sky) :: <A HREF="s2_gcmbcoad.html#var_mask">mask</A>
    type (s2_sky), dimension (NUM_BANDS) :: <A HREF="s2_gcmbcoad.html#var_nobs">nobs</A>
    type (s2_cmb) :: <A HREF="s2_gcmbcoad.html#var_cmb">cmb</A>
    type (s2_sky) :: <A HREF="s2_gcmbcoad.html#var_cmb_sky">cmb_sky</A>
    type (s2_sky), dimension (NUM_BANDS) :: <A HREF="s2_gcmbcoad.html#var_cmb_sky_beam">cmb_sky_beam</A>
    type (s2_sky) :: <A HREF="s2_gcmbcoad.html#var_sky_temp">sky_temp</A>
    type (s2_sky) :: <A HREF="s2_gcmbcoad.html#var_cmb_coadded">cmb_coadded</A>
    type (s2_sky) :: <A HREF="s2_gcmbcoad.html#var_cmb_coadded_unscaled">cmb_coadded_unscaled</A>
    type (s2_wnoise) :: <A HREF="s2_gcmbcoad.html#var_wnoise">wnoise</A>
    type (s2_sky), dimension (NUM_BANDS) :: <A HREF="s2_gcmbcoad.html#var_wnoise_sky">wnoise_sky</A>
    type (s2_sky) :: <A HREF="s2_gcmbcoad.html#var_wnoise_coadded">wnoise_coadded</A>
    type (s2_sky) :: <A HREF="s2_gcmbcoad.html#var_wnoise_coadded_unscaled">wnoise_coadded_unscaled</A>
    real (kind=s2_sp), allocatable, dimension (:) :: <A HREF="s2_gcmbcoad.html#var_nobs_map">nobs_map</A>
    real (kind=s2_sp), allocatable, dimension (:) :: <A HREF="s2_gcmbcoad.html#var_weights_map">weights_map</A>

        ! Interfaces
    interface <A HREF="s2_gcmbcoad.html#interface_s2_gcmbcoad_weightedsum">s2_gcmbcoad_weightedsum</A>

        ! Subroutines and functions
    subroutine <A HREF="s2_gcmbcoad.html#subroutine_parse_options">parse_options</A> ()

end program s2_gcmbcoad
</PRE>
 Generate co-added Gaussian CMB and noise realisations.  Realisations are
 simulated for each WMAP channel by convolving with the approriate beam
 function and adding appropriate noise for the specific receiver.  The
 signals from each receiver are combined to give a coadded map, using the
 processing pipeline specified by Komatsu et al. (2003).
<P>
 Usage: s2_gcmbcoad
   <UL>
   <LI>  [-help]: Display usage information.
   <LI>  [-isim_start isim_start]: Index of first simulation to compute.
   <LI>  [-isim_end isim_end (optional)]: Index fo last simulation to compute.
     (If not specified only one simualtion is made for index isim_start.)
   <LI>  [-dir_cl dir_cl]: Directory containing CMB power specftrum file.
   <LI>  [-dir_nobs dir_nobs (set to dir_cl if not specified)]: Directory
     containing WMAP map files with NOBS field in extension 2.
   <LI>  [-dir_beam dir_beam (set to dir_cl if not specified)]: Directory
     containting beam transfer function files.
   <LI>  [-mask filename_mask (optional)]: Mask file to apply.  If not
     sepcified no mask is applied.
   <LI>  [-lmax lmax]: Maximum harmonic l to consider.
   <LI>  [-out_cmb_prefix filename_out_cmb_prefix]: Prefix of output
     coadded cmb map file names (simulation index and .fits automatically
     appended to end of name).
   <LI>  [-out_noise_prefix filename_out_noise_prefix]: Prefix of output
     coadded noise map file names (simulation index and .fits automatically
     appended to end of name).
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen (mcewen@mrao.cam.ac.uk)
<P>
<STRONG>Version:</STRONG> 0.1 - October 2005

<HR><H2> Description of Variables </H2>
<A NAME="var_num_bands"><H3>NUM_BANDS</H3></A>
<PRE>integer, parameter :: NUM_BANDS = 8
</PRE>
<A NAME="var_nobs_ext"><H3>NOBS_EXT</H3></A>
<PRE>integer, parameter :: NOBS_EXT = 2
</PRE>
<A NAME="var_lmax_limit"><H3>LMAX_LIMIT</H3></A>
<PRE>integer, parameter :: LMAX_LIMIT = 1000
</PRE>
<A NAME="var_nside_final"><H3>NSIDE_FINAL</H3></A>
<PRE>integer, parameter :: NSIDE_FINAL = 256
</PRE>
<A NAME="var_msgpfx"><H3>msgpfx</H3></A>
<PRE>character (len=*), parameter :: msgpfx = 's2_gcmbcoad> '
</PRE>
<A NAME="var_sigma0"><H3>SIGMA0</H3></A>
<PRE>real (kind=s2_sp), parameter, dimension (NUM_BANDS) :: SIGMA0 = (/ 2.26677, 2.15567, 3.28789, 2.93683, 5.85196, 6.53276, 6.88032, 6.72537 /)
</PRE>
<A NAME="var_filename_nobs"><H3>filename_nobs</H3></A>
<PRE>character (len=S2_STRING_LEN), parameter, dimension (NUM_BANDS) :: filename_nobs = (/ 'wmap_q1_cleanimap_yr1_v1.fits', 'wmap_q2_cleanimap_yr1_v1.fits', 'wmap_v1_cleanimap_yr1_v1.fits', 'wmap_v2_cleanimap_yr1_v1.fits', 'wmap_w1_cleanimap_yr1_v1.fits', 'wmap_w2_cleanimap_yr1_v1.fits', 'wmap_w3_cleanimap_yr1_v1.fits', 'wmap_w4_cleanimap_yr1_v1.fits' /)
</PRE>
<A NAME="var_filename_beam"><H3>filename_beam</H3></A>
<PRE>character (len=S2_STRING_LEN), parameter, dimension (NUM_BANDS) :: filename_beam = (/ 'map_q1_ampl_bl_yr1_v1.txt', 'map_q2_ampl_bl_yr1_v1.txt', 'map_v1_ampl_bl_yr1_v1.txt', 'map_v2_ampl_bl_yr1_v1.txt', 'map_w1_ampl_bl_yr1_v1.txt', 'map_w2_ampl_bl_yr1_v1.txt', 'map_w3_ampl_bl_yr1_v1.txt', 'map_w4_ampl_bl_yr1_v1.txt' /)
</PRE>
<A NAME="var_filename_mask"><H3>filename_mask</H3></A>
<PRE>character (len=S2_STRING_LEN) :: filename_mask
</PRE>
<A NAME="var_filename_cl"><H3>filename_cl</H3></A>
<PRE>character (len=S2_STRING_LEN) :: filename_cl = 'wmap_lcdm_pl_model_yr1_v1.txt'
</PRE>
<A NAME="var_filename_out"><H3>filename_out</H3></A>
<PRE>character (len=S2_STRING_LEN) :: filename_out
</PRE>
<A NAME="var_filename_out_cmb_prefix"><H3>filename_out_cmb_prefix</H3></A>
<PRE>character (len=S2_STRING_LEN) :: filename_out_cmb_prefix = 'gcmb_coadded_'
</PRE>
<A NAME="var_filename_out_noise_prefix"><H3>filename_out_noise_prefix</H3></A>
<PRE>character (len=S2_STRING_LEN) :: filename_out_noise_prefix = 'wnoise_coadded_'
</PRE>
<A NAME="var_comment_out"><H3>comment_out</H3></A>
<PRE>character (len=S2_STRING_LEN) :: comment_out = 'seed not specified'
</PRE>
<A NAME="var_filename_current"><H3>filename_current</H3></A>
<PRE>character (len=S2_STRING_LEN) :: filename_current
</PRE>
<A NAME="var_dir_cl"><H3>dir_cl</H3></A>
<PRE>character (len=S2_STRING_LEN) :: dir_cl = 'data_input'
</PRE>
<A NAME="var_dir_nobs"><H3>dir_nobs</H3></A>
<PRE>character (len=S2_STRING_LEN) :: dir_nobs = 'data_input'
</PRE>
<A NAME="var_dir_beam"><H3>dir_beam</H3></A>
<PRE>character (len=S2_STRING_LEN) :: dir_beam = 'data_input'
</PRE>
<A NAME="var_isim_start"><H3>isim_start</H3></A>
<PRE>integer :: isim_start = 1
</PRE>
<A NAME="var_isim_end"><H3>isim_end</H3></A>
<PRE>integer :: isim_end = 1
</PRE>
<A NAME="var_lmax"><H3>lmax</H3></A>
<PRE>integer :: lmax
</PRE>
<A NAME="var_lmin_cl"><H3>lmin_cl</H3></A>
<PRE>integer :: lmin_cl
</PRE>
<A NAME="var_lmin_beam"><H3>lmin_beam</H3></A>
<PRE>integer :: lmin_beam
</PRE>
<A NAME="var_iband"><H3>iband</H3></A>
<PRE>integer :: iband
</PRE>
<A NAME="var_isim"><H3>isim</H3></A>
<PRE>integer :: isim
</PRE>
<A NAME="var_fail"><H3>fail</H3></A>
<PRE>integer :: fail
</PRE>
<A NAME="var_ncomment_cl"><H3>ncomment_cl</H3></A>
<PRE>integer :: ncomment_cl
</PRE>
<A NAME="var_ncomment_beam"><H3>ncomment_beam</H3></A>
<PRE>integer :: ncomment_beam
</PRE>
<A NAME="var_seed_cmb"><H3>seed_cmb</H3></A>
<PRE>integer :: seed_cmb = 1
</PRE>
<A NAME="var_seed_noise"><H3>seed_noise</H3></A>
<PRE>integer :: seed_noise = 1
</PRE>
<A NAME="var_scale_in_cl"><H3>scale_in_cl</H3></A>
<PRE>logical :: scale_in_cl = .true.
</PRE>
<A NAME="var_scale_in_beam"><H3>scale_in_beam</H3></A>
<PRE>logical :: scale_in_beam = .false.
</PRE>
<A NAME="var_line_nos_in_cl"><H3>line_nos_in_cl</H3></A>
<PRE>logical :: line_nos_in_cl = .true.
</PRE>
<A NAME="var_line_nos_in_beam"><H3>line_nos_in_beam</H3></A>
<PRE>logical :: line_nos_in_beam = .true.
</PRE>
<A NAME="var_apply_mask"><H3>apply_mask</H3></A>
<PRE>logical :: apply_mask = .false.
</PRE>
<A NAME="var_cl"><H3>cl</H3></A>
<PRE>type (s2_pl) :: cl
</PRE>
<A NAME="var_beam"><H3>beam</H3></A>
<PRE>type (s2_pl), dimension (NUM_BANDS) :: beam
</PRE>
<A NAME="var_weights"><H3>weights</H3></A>
<PRE>type (s2_sky), dimension (NUM_BANDS) :: weights
</PRE>
<A NAME="var_weights_sum"><H3>weights_sum</H3></A>
<PRE>type (s2_sky) :: weights_sum
</PRE>
<A NAME="var_weights_temp"><H3>weights_temp</H3></A>
<PRE>type (s2_sky) :: weights_temp
</PRE>
<A NAME="var_mask"><H3>mask</H3></A>
<PRE>type (s2_sky) :: mask
</PRE>
<A NAME="var_nobs"><H3>nobs</H3></A>
<PRE>type (s2_sky), dimension (NUM_BANDS) :: nobs
</PRE>
<A NAME="var_cmb"><H3>cmb</H3></A>
<PRE>type (s2_cmb) :: cmb
</PRE>
<A NAME="var_cmb_sky"><H3>cmb_sky</H3></A>
<PRE>type (s2_sky) :: cmb_sky
</PRE>
<A NAME="var_cmb_sky_beam"><H3>cmb_sky_beam</H3></A>
<PRE>type (s2_sky), dimension (NUM_BANDS) :: cmb_sky_beam
</PRE>
<A NAME="var_sky_temp"><H3>sky_temp</H3></A>
<PRE>type (s2_sky) :: sky_temp
</PRE>
<A NAME="var_cmb_coadded"><H3>cmb_coadded</H3></A>
<PRE>type (s2_sky) :: cmb_coadded
</PRE>
<A NAME="var_cmb_coadded_unscaled"><H3>cmb_coadded_unscaled</H3></A>
<PRE>type (s2_sky) :: cmb_coadded_unscaled
</PRE>
<A NAME="var_wnoise"><H3>wnoise</H3></A>
<PRE>type (s2_wnoise) :: wnoise
</PRE>
<A NAME="var_wnoise_sky"><H3>wnoise_sky</H3></A>
<PRE>type (s2_sky), dimension (NUM_BANDS) :: wnoise_sky
</PRE>
<A NAME="var_wnoise_coadded"><H3>wnoise_coadded</H3></A>
<PRE>type (s2_sky) :: wnoise_coadded
</PRE>
<A NAME="var_wnoise_coadded_unscaled"><H3>wnoise_coadded_unscaled</H3></A>
<PRE>type (s2_sky) :: wnoise_coadded_unscaled
</PRE>
<A NAME="var_nobs_map"><H3>nobs_map</H3></A>
<PRE>real (kind=s2_sp), allocatable, dimension (:) :: nobs_map
</PRE>
<A NAME="var_weights_map"><H3>weights_map</H3></A>
<PRE>real (kind=s2_sp), allocatable, dimension (:) :: weights_map
</PRE>

<HR><H2> Description of Interfaces </H2>
<A NAME="interface_s2_gcmbcoad_weightedsum"><H3>s2_gcmbcoad_weightedsum</H3></A>
<PRE>interface s2_gcmbcoad_weightedsum
    function s2_gcmbcoad_weightedsum (skies, weights) result (sky_coadded)
        type (s2_sky), intent(inout), dimension (1:) :: skies
        type (s2_sky), intent(inout), dimension (1:) :: weights
        type (s2_sky) :: sky_coadded
    end function s2_gcmbcoad_weightedsum
end interface s2_gcmbcoad_weightedsum
</PRE>

<HR><H2> Description of Subroutines and Functions </H2>
<A NAME="subroutine_parse_options"><H3>parse_options</H3></A>
<PRE>subroutine parse_options ()
    ! Calls: getArgument
end subroutine parse_options
</PRE>
 Parse the options passed when program called.
<P>
<STRONG>Author:</STRONG> J. D. McEwen (mcewen@mrao.cam.ac.uk)
<P>
<STRONG>Version:</STRONG> 0.1 - October 2005
</HTML>
