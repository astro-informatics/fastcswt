<HTML>
<HEAD>
   <TITLE> module s2_cmb_mod (generated by f90doc) </TITLE>
  <LINK rel="stylesheet" href="stylesheet.css" type="text/css" /> </HEAD>
<H1> Module s2_cmb_mod </H1>
<PRE>module s2_cmb_mod

        ! Uses
    use <A HREF="s2_types_mod.html">s2_types_mod</A>
    use <A HREF="s2_error_mod.html">s2_error_mod</A>
    use <A HREF="s2_distn_mod.html">s2_distn_mod</A>
    use <A HREF="s2_pl_mod.html">s2_pl_mod</A>
    use <A HREF="s2_sky_mod.html">s2_sky_mod</A>
    use <A HREF="s2_wnoise_mod.html">s2_wnoise_mod</A>

        ! Types
    public type <A HREF="s2_cmb_mod.html#type_s2_cmb">s2_cmb</A>

        ! Interfaces
    public interface <A HREF="s2_cmb_mod.html#interface_s2_cmb_init">s2_cmb_init</A>

        ! Subroutines and functions
    private function <A HREF="s2_cmb_mod.html#function_s2_cmb_init_pl">s2_cmb_init_pl</A> (clt, nside, seed, beam, compute_map) result (cmb)
    private function <A HREF="s2_cmb_mod.html#function_s2_cmb_init_array">s2_cmb_init_array</A> (clt_spec, nside, seed, beam, compute_map) result (cmb)
    private function <A HREF="s2_cmb_mod.html#function_s2_cmb_init_file">s2_cmb_init_file</A> (filename_clt, nside, lmin, lmax, ncomment, seed, beam, scale_cl, compute_map) result (cmb)
    private function <A HREF="s2_cmb_mod.html#function_s2_cmb_init_copy">s2_cmb_init_copy</A> (orig) result (copy)
    public subroutine <A HREF="s2_cmb_mod.html#subroutine_s2_cmb_free">s2_cmb_free</A> (cmb)
    public subroutine <A HREF="s2_cmb_mod.html#subroutine_s2_cmb_gen_sky">s2_cmb_gen_sky</A> (cmb, seed, beam, compute_map)
    private subroutine <A HREF="s2_cmb_mod.html#subroutine_s2_cmb_apply_beam">s2_cmb_apply_beam</A> (cmb, beam)
    private subroutine <A HREF="s2_cmb_mod.html#subroutine_s2_cmb_create_alm">s2_cmb_create_alm</A> (cmb, seed_in)
    private subroutine <A HREF="s2_cmb_mod.html#subroutine_s2_cmb_compute_map">s2_cmb_compute_map</A> (cmb)
    public subroutine <A HREF="s2_cmb_mod.html#subroutine_s2_cmb_map_convert">s2_cmb_map_convert</A> (cmb, pix_scheme)
    public subroutine <A HREF="s2_cmb_mod.html#subroutine_s2_cmb_add_noise">s2_cmb_add_noise</A> (cmb, wnoise)
    public subroutine <A HREF="s2_cmb_mod.html#subroutine_s2_cmb_write_sky">s2_cmb_write_sky</A> (cmb, filename, comment)
    public function <A HREF="s2_cmb_mod.html#function_s2_cmb_get_init">s2_cmb_get_init</A> (cmb) result (init)
    public function <A HREF="s2_cmb_mod.html#function_s2_cmb_get_nside">s2_cmb_get_nside</A> (cmb) result (nside)
    public function <A HREF="s2_cmb_mod.html#function_s2_cmb_get_npix">s2_cmb_get_npix</A> (cmb) result (npix)
    public function <A HREF="s2_cmb_mod.html#function_s2_cmb_get_lmax">s2_cmb_get_lmax</A> (cmb) result (lmax)
    public function <A HREF="s2_cmb_mod.html#function_s2_cmb_get_sky">s2_cmb_get_sky</A> (cmb) result (sky)
    public function <A HREF="s2_cmb_mod.html#function_s2_cmb_get_clt">s2_cmb_get_clt</A> (cmb) result (clt)
    public function <A HREF="s2_cmb_mod.html#function_s2_cmb_get_noise_added">s2_cmb_get_noise_added</A> (cmb) result (noise_added)
    public function <A HREF="s2_cmb_mod.html#function_s2_cmb_get_beam_applied">s2_cmb_get_beam_applied</A> (cmb) result (beam_applied)

end module s2_cmb_mod
</PRE>
 Provides functionality to create a Gaussian simuated CMB map.  The map 
 is realised from Gaussain alms that satisfy the specified CMB power 
 spectrum.
<P>
<STRONG>Author:</STRONG> J. D. McEwen (mcewen@mrao.cam.ac.uk)
<P>
<STRONG>Version:</STRONG> 0.1 August 2004

<HR><H2> Description of Types </H2>
<A NAME="type_s2_cmb"><H3>s2_cmb</H3></A>
<PRE>public type s2_cmb
    private
    logical :: init = .false.
    integer :: seed
    integer :: nside = 0
    type (s2_sky) :: sky
    type (s2_pl) :: clt
    logical :: noise_added = .false.
    logical :: beam_applied = .false.
end type s2_cmb
</PRE>

<HR><H2> Description of Interfaces </H2>
<A NAME="interface_s2_cmb_init"><H3>s2_cmb_init</H3></A>
<PRE>public interface s2_cmb_init
    module procedure <A HREF="#function_s2_cmb_init_pl">s2_cmb_init_pl</A>
    module procedure <A HREF="#function_s2_cmb_init_array">s2_cmb_init_array</A>
    module procedure <A HREF="#function_s2_cmb_init_file">s2_cmb_init_file</A>
    module procedure <A HREF="#function_s2_cmb_init_copy">s2_cmb_init_copy</A>
end interface s2_cmb_init
</PRE>

<HR><H2> Description of Subroutines and Functions </H2>
<A NAME="function_s2_cmb_init_pl"><H3>s2_cmb_init_pl</H3></A>
<PRE>private function s2_cmb_init_pl (clt, nside, seed, beam, compute_map) result (cmb)
    type (s2_pl), intent(in) :: clt
    integer, intent(in) :: nside
    integer, intent(in) :: seed
    type (s2_pl), optional, intent(in) :: beam
    logical, optional, intent(in) :: compute_map
    type (s2_cmb) :: cmb
    ! Calls: s2_cmb_gen_sky, s2_error
end function s2_cmb_init_pl
</PRE>
 Initialise a Gaussian cmb form a clt spectrum pl object.
 If beam is present then the realised cmb alms are convolved with the 
 beam before the cmb map is generated.
<P>
 Variables:
   <UL>
   <LI>  clt: Clt spectrum that fully defines the statistical 
     characteristics of a cmb realisation as a pl object.
   <LI>  nside: Sky Healpix resolution.
   <LI>  seed: Seed for generating samples from a Gaussian distribution.
   <LI>  [beam]: If present then the amb alms are convolved with this beam
     before a map representation is constructed.
   <LI>  [compute_map]: Logical to specify whether to compute the cmb map from
     the alms (default is true).
   <LI>  cmb: Cmb initialised.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="function_s2_cmb_init_array"><H3>s2_cmb_init_array</H3></A>
<PRE>private function s2_cmb_init_array (clt_spec, nside, seed, beam, compute_map) result (cmb)
    real (kind=s2_sp), intent(in), dimension (:) :: clt_spec
    integer, intent(in) :: nside
    integer, intent(in) :: seed
    type (s2_pl), optional, intent(in) :: beam
    logical, optional, intent(in) :: compute_map
    type (s2_cmb) :: cmb
    ! Calls: s2_cmb_gen_sky, s2_error
end function s2_cmb_init_array
</PRE>
 Initialise a Gaussian cmb form a clt spectrum array.
 If beam is present then the realised cmb alms are convolved with the 
 beam before the cmb map is generated.
<P>
 Variables:
   <UL>
   <LI>  clt_spec: Clt spectrum that fully defines the statistical 
     characteristics of a cmb realisation.
   <LI>  nside: Sky Healpix resolution.
   <LI>  seed: Seed for generating samples from a Gaussian distribution.
   <LI>  [beam]: If present then the amb alms are convolved with this beam
     before a map representation is constructed.
   <LI>  [compute_map]: Logical to specify whether to compute the cmb map from
     the alms (default is true).
   <LI>  cmb: Cmb initialised.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="function_s2_cmb_init_file"><H3>s2_cmb_init_file</H3></A>
<PRE>private function s2_cmb_init_file (filename_clt, nside, lmin, lmax, ncomment, seed, beam, scale_cl, compute_map) result (cmb)
    character (len=*), intent(in) :: filename_clt
    integer, intent(in) :: nside
    integer, intent(in) :: lmin
    integer, intent(in) :: lmax
    integer, intent(in) :: ncomment
    integer, intent(in) :: seed
    type (s2_pl), optional, intent(in) :: beam
    logical, optional, intent(in) :: scale_cl
    logical, optional, intent(in) :: compute_map
    type (s2_cmb) :: cmb
    ! Calls: s2_cmb_gen_sky, s2_error
end function s2_cmb_init_file
</PRE>
 Initialise a Gaussian cmb from a file containing a clt spectrum.
 If beam is present then the realised cmb alms are convolved with the 
 beam before the cmb map is generated.
<P>
 Variables:
   <UL>
   <LI>  filename_clt: Name of the file containing the clt spectrum.
   <LI>  nside: Sky Healpix resolution.
   <LI>  lmin: Minimum l value read from file.  (The first value read will 
     be saved a this l.  Clt for all lower values of l is set to zero. 
     Typically lmin=2 so monopole and dipole not included.)
   <LI>  lmax: Maximum l value of clt.
   <LI>  ncomment: Number of comment lines in file to ignore before start 
     reading clt values.
   <LI>  seed: Seed for generating samples from a Gaussian distribution.
   <LI>  [beam]: If present then the amb alms are convolved with this beam
     before a map representation is constructed.
   <LI>  [compute_map]: Logical to specify whether to compute the cmb map from
     the alms (default is true).
   <LI>  cmb: Cmb initialised.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="function_s2_cmb_init_copy"><H3>s2_cmb_init_copy</H3></A>
<PRE>private function s2_cmb_init_copy (orig) result (copy)
    type (s2_cmb), intent(in) :: orig
    type (s2_cmb) :: copy
    ! Calls: s2_error
end function s2_cmb_init_copy
</PRE>
 Initialise a cmb from a copy of an original cmb.
<P>
 Variables:
   <UL>
   <LI>  orig: Original cmb to be copied.
   <LI>  copy: Initialised cmb with attributes copied from orig.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="subroutine_s2_cmb_free"><H3>s2_cmb_free</H3></A>
<PRE>public subroutine s2_cmb_free (cmb)
    type (s2_cmb), intent(inout) :: cmb
    ! Calls: s2_error, s2_pl_free, s2_sky_free
end subroutine s2_cmb_free
</PRE>
 Free all data associated with an initialised cmb and reset all other 
 attributes.
 Variables:
   <UL>
   <LI>  cmb: Cmb to be freed.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="subroutine_s2_cmb_gen_sky"><H3>s2_cmb_gen_sky</H3></A>
<PRE>public subroutine s2_cmb_gen_sky (cmb, seed, beam, compute_map)
    type (s2_cmb), intent(inout) :: cmb
    integer, optional, intent(in) :: seed
    type (s2_pl), optional, intent(in) :: beam
    logical, optional, intent(in) :: compute_map
    ! Calls: s2_cmb_apply_beam, s2_cmb_compute_map, s2_cmb_create_alm, s2_error, s2_sky_scale
end subroutine s2_cmb_gen_sky
</PRE>
 Generate a sky realisation of the cmb from the clt spectrum.  
 First Gaussian alm values that satisfy the clt spectrum are generated, 
 these are convolved with a beam (if present), before the map realisation
 is computed from an inverse spherical harmonic transform.
<P>
 Notes:
   <UL>
   <LI>  Object must be initialised before this routine is call.  If to be 
     called from init function then must set init status first.
   <LI>  Map is converted here to have units of mK. -- Not any more!
<P>
   </UL>
 Variables:
   <UL>
   <LI>  cmb: Cmb to generate sky map of.
   <LI>  [seed]: Seed for sampling Gaussian distribution.  If not present 
     the cmb seed attribute will be used.
   <LI>  [beam]: Beam function.  No beam is convolved if not present.
   <LI>  [compute_map]: Logical to specify whether to compute the cmb map from
     the alms (default is true).
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="subroutine_s2_cmb_apply_beam"><H3>s2_cmb_apply_beam</H3></A>
<PRE>private subroutine s2_cmb_apply_beam (cmb, beam)
    type (s2_cmb), intent(inout) :: cmb
    type (s2_pl), intent(in) :: beam
    ! Calls: s2_error, s2_pl_conv, s2_sky_free, s2_sky_get_alm
end subroutine s2_cmb_apply_beam
</PRE>
 Convolve beam with cmb alms.  The cmb alms are overwritten with the 
 convolved alms.
<P>
 Variables:
   <UL>
   <LI>  cmb: Cmb to apply beam to.
   <LI>  beam: Beam to apply.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="subroutine_s2_cmb_create_alm"><H3>s2_cmb_create_alm</H3></A>
<PRE>private subroutine s2_cmb_create_alm (cmb, seed_in)
    type (s2_cmb), intent(inout) :: cmb
    integer, optional, intent(in) :: seed_in
    ! Calls: s2_error, s2_sky_free
end subroutine s2_cmb_create_alm
</PRE>
 Create Gaussian cmb alms that satify the clt spectrum.
<P>
 Variables:
   <UL>
   <LI>  cmb: Cmb to create alms for.
   <LI>  [seed_in]: Seed to generate samples from a Gaussian distribution.  If
     not present then the cmb seed attribute is used.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="subroutine_s2_cmb_compute_map"><H3>s2_cmb_compute_map</H3></A>
<PRE>private subroutine s2_cmb_compute_map (cmb)
    type (s2_cmb), intent(inout) :: cmb
    ! Calls: s2_error, s2_sky_compute_map
end subroutine s2_cmb_compute_map
</PRE>
 Compute the cmb sky map from alms.
<P>
 Variables:
   <UL>
   <LI>  cmb: Cmb to compute map of.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="subroutine_s2_cmb_map_convert"><H3>s2_cmb_map_convert</H3></A>
<PRE>public subroutine s2_cmb_map_convert (cmb, pix_scheme)
    type (s2_cmb), intent(inout) :: cmb
    integer, intent(in) :: pix_scheme
    ! Calls: s2_error, s2_sky_map_convert
end subroutine s2_cmb_map_convert
</PRE>
 Convert sky map pixelisation scheme between nested and ring.
<P>
 Variables:
   <UL>
   <LI>  cmb: Cmb to convert pixelisation scheme of.
   <LI>  pix_scheme: Pixelisation scheme to convert to.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="subroutine_s2_cmb_add_noise"><H3>s2_cmb_add_noise</H3></A>
<PRE>public subroutine s2_cmb_add_noise (cmb, wnoise)
    type (s2_cmb), intent(inout) :: cmb
    type (s2_wnoise), intent(in) :: wnoise
    ! Calls: s2_error, s2_sky_free
end subroutine s2_cmb_add_noise
</PRE>
 Add noise to the cmb sky map.  The cmb noise_added attribute flag is 
 also set.
<P>
 Notes:
   <UL>
   <LI>  When noise is added to the cmb sky, the old sky is overwritten with
     the new one (the sum of the old one and the noise sky).  Since the
     old alms correspond only to the old simulated cmb map, and not the
     map plus noise, they are wiped from the resultant sky saved.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  cmb: Cmb to add noise to.
   <LI>  wnoise: White noise object containing noise realisation to add to 
     cmb sky map.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="subroutine_s2_cmb_write_sky"><H3>s2_cmb_write_sky</H3></A>
<PRE>public subroutine s2_cmb_write_sky (cmb, filename, comment)
    type (s2_cmb), intent(in) :: cmb
    character (len=*), intent(in) :: filename
    character (len=*), optional, intent(in) :: comment
    ! Calls: s2_error, s2_sky_write_map_file
end subroutine s2_cmb_write_sky
</PRE>
 Write the cmb sky to an output fits file.
<P>
 Variables:
   <UL>
   <LI>  cmb: Cmb to be written to a fits file.
   <LI>  filename: Name of the outout fits file.
   <LI>  [comment]: Optional comment to add to header of output file.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="function_s2_cmb_get_init"><H3>s2_cmb_get_init</H3></A>
<PRE>public function s2_cmb_get_init (cmb) result (init)
    type (s2_cmb), intent(in) :: cmb
    logical :: init
end function s2_cmb_get_init
</PRE>
 Get init variable from the passed cmb.
<P>
 Variables:
   <UL>
   <LI>  cmb: Cmb object to get the variable of.
   <LI>  init: Object init variable returned.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="function_s2_cmb_get_nside"><H3>s2_cmb_get_nside</H3></A>
<PRE>public function s2_cmb_get_nside (cmb) result (nside)
    type (s2_cmb), intent(in) :: cmb
    integer :: nside
    ! Calls: s2_error
end function s2_cmb_get_nside
</PRE>
 Get nside variable from the passed cmb.
<P>
 Variables:
   <UL>
   <LI>  cmb: Cmb object to get the variable of.
   <LI>  nside: Object nside variable returned.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="function_s2_cmb_get_npix"><H3>s2_cmb_get_npix</H3></A>
<PRE>public function s2_cmb_get_npix (cmb) result (npix)
    type (s2_cmb), intent(in) :: cmb
    integer :: npix
    ! Calls: s2_error
end function s2_cmb_get_npix
</PRE>
 Get npix variable from the passed cmb.
<P>
 Variables:
   <UL>
   <LI>  cmb: Cmb object to get the variable of.
   <LI>  npix: Object npix variable returned.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="function_s2_cmb_get_lmax"><H3>s2_cmb_get_lmax</H3></A>
<PRE>public function s2_cmb_get_lmax (cmb) result (lmax)
    type (s2_cmb), intent(in) :: cmb
    integer :: lmax
    ! Calls: s2_error
end function s2_cmb_get_lmax
</PRE>
 Get lmax variable from the passed cmb.
<P>
 Variables:
   <UL>
   <LI>  cmb: Cmb object to get the variable of.
   <LI>  lmax: Object lmax variable returned.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="function_s2_cmb_get_sky"><H3>s2_cmb_get_sky</H3></A>
<PRE>public function s2_cmb_get_sky (cmb) result (sky)
    type (s2_cmb), intent(in) :: cmb
    type (s2_sky) :: sky
    ! Calls: s2_error
end function s2_cmb_get_sky
</PRE>
 Get sky variable from the passed cmb.
<P>
 Notes:
   <UL>
   <LI>  Initialises a new sky as a copy of the cmb sky.
   <LI>  The returned sky is subsequently independed of the sky stored
     herein and should be freed by the calling routine at some point.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  cmb: Cmb object to get the variable of.
   <LI>  sky: Object sky variable returned.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="function_s2_cmb_get_clt"><H3>s2_cmb_get_clt</H3></A>
<PRE>public function s2_cmb_get_clt (cmb) result (clt)
    type (s2_cmb), intent(in) :: cmb
    type (s2_pl) :: clt
    ! Calls: s2_error
end function s2_cmb_get_clt
</PRE>
 Get clt variable from the passed cmb.
<P>
 Notes:
   <UL>
   <LI>  Initialises a new clt as a copy of the cmb clt.
   <LI>  The returned clt is subsequently independed of the clt stored
     herein and should be freed by the calling routine at some point.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  cmb: Cmb object to get the variable of.
   <LI>  clt: Object clt variable returned.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="function_s2_cmb_get_noise_added"><H3>s2_cmb_get_noise_added</H3></A>
<PRE>public function s2_cmb_get_noise_added (cmb) result (noise_added)
    type (s2_cmb), intent(in) :: cmb
    logical :: noise_added
    ! Calls: s2_error
end function s2_cmb_get_noise_added
</PRE>
 Get noise_added variable from the passed cmb.
<P>
 Variables:
   <UL>
   <LI>  cmb: Cmb object to get the variable of.
   <LI>  noise_added: Object noise_added variable returned.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
<A NAME="function_s2_cmb_get_beam_applied"><H3>s2_cmb_get_beam_applied</H3></A>
<PRE>public function s2_cmb_get_beam_applied (cmb) result (beam_applied)
    type (s2_cmb), intent(in) :: cmb
    logical :: beam_applied
    ! Calls: s2_error
end function s2_cmb_get_beam_applied
</PRE>
 Get beam_applied variable from the passed cmb.
<P>
 Variables:
   <UL>
   <LI>  cmb: Cmb object to get the variable of.
   <LI>  beam_applied: Object beam_applied variable returned.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 August 2004
</HTML>
